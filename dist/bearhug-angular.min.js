!function(a){function b(){function b(b){var c=a.isString(b)&&b.match(d);return a.isArray(c)&&c[1]?c[1]:void 0}function c(b){return a.isString(b)?"Bearer "+b:void 0}var d=/^Bearer (.*)$/;return{bearer2token:b,token2bearer:c}}function c(a){a.interceptors.push("bearhugInterceptor")}function d(){var b={authenticationFunction:null};this.setAuthenticationFunction=function(c){b.authenticationFunction=a.isFunction(c)?c:b.authenticationFunction},this.$get=["bearhugAuthenticator","bearhugStorage",function(c,d){function e(a){return c.authenticate(f,a)}var f=a.copy(b);if(a.isFunction(f.authenticationFunction))return{options:f,authenticate:e,getToken:d.getToken,getBearer:d.getBearer};throw new Error("No authentication function specified. How can bearhug authenticate?")}]}function e(b,c,d,e){function f(b){var f=a.isObject(b)?b:{};if(a.isFunction(f.authenticationFunction)){if(g)return g.promise;g=d.defer();var h=f.authenticationFunction(c).then(function(b){e.setToken(b);var c=e.getToken();c?g.resolve(c):g.reject(new Error("Token response is not a string: "+a.toJson(b)))})["catch"](g.reject);return h["finally"](function(){g=void 0}),g.promise}throw new Error("No authentication function available to bearhugAuthenticator")}var g;return{authenticate:f}}function f(a,b,c){function d(a){var b=c.getBearer();return b&&a&&a.headers&&(a.headers.Authorization=b),a}function e(a){var b=a&&a.headers("Authorization");return b&&c.setBearer(b),a}function f(c){var d=b.get("$http"),e=b.get("bearhug");return c&&c.status&&c.config?401!==c.status?a.reject(c):e.authenticate(c.config).then(function(){return d(c.config)})["catch"](function(b){return a.reject(c)}):a.reject(c)}return{request:d,response:e,responseError:f}}function g(b){function c(){return g||null}function d(b){g=a.isString(b)?b:g}function e(){return b.token2bearer(c())||null}function f(a){var c=b.bearer2token(a);d(c)}var g=null;return{getToken:c,setToken:d,getBearer:e,setBearer:f}}function h(b){function c(a){return{apply:function(b){return d(b,a)}}}function d(b,c){var d={},h=e(c);for(var i in b||{})a.isFunction(b[i])&&a.isFunction(h[i])?d[i]=f(b[i],h[i],g[i]):a.isFunction(b[i])&&(d[i]=b[i]);return d}function e(b){return a.isFunction(b)?{request:b,requestError:b,response:b,responseError:b}:a.isObject(b)?b:{}}function f(a,b,c){return function(){var d=arguments.length>=1?Array.prototype.slice.call(arguments,0):[];return b.apply(null,d)?a.apply(null,d):c.apply(null,d)}}var g={request:function(a){return a},requestError:function(a){return b.reject(a)},response:function(a){return a},responseError:function(a){return b.reject(a)}};return{wrapInterceptor:d,InterceptorFilter:c}}c.$inject=["$httpProvider"],e.$inject=["$http","$injector","$q","bearhugStorage"],f.$inject=["$q","$injector","bearhugStorage"],g.$inject=["bearerUtils"],h.$inject=["$q"],a.module("talis.bearhug",[]),a.module("talis.bearhug").factory("bearerUtils",b),a.module("talis.bearhug").config(c),a.module("talis.bearhug").provider("bearhug",d),a.module("talis.bearhug").factory("bearhugAuthenticator",e),a.module("talis.bearhug").factory("bearhugInterceptor",f),a.module("talis.bearhug").factory("bearhugStorage",g),a.module("talis.bearhug").factory("interceptorFilter",h)}(angular);