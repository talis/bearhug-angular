!function(a){function b(){function b(b){var c=a.isString(b)&&b.match(d);return a.isArray(c)&&c[1]?c[1]:void 0}function c(b){return a.isString(b)?"Bearer "+b:void 0}var d=/^Bearer ([a-zA-Z0-9\._\-]+)$/;return{bearer2token:b,token2bearer:c}}function c(){var b={authenticationFunction:null};this.setAuthenticationFunction=function(c){b.authenticationFunction=a.isFunction(c)?c:b.authenticationFunction},this.$get=["bearhugAuthenticator","bearhugStorage",function(c,d){function e(a){return c.authenticate(f,a)}var f=a.copy(b);if(a.isFunction(f.authenticationFunction))return{options:f,authenticate:e,getToken:d.getToken,getBearer:d.getBearer};throw new Error("No authentication function specified. How can bearhug authenticate?")}]}function d(b,c,d,e){function f(b){var f=a.isObject(b)?b:{};if(a.isFunction(f.authenticationFunction)){if(g)return g.promise;g=d.defer();var h=f.authenticationFunction(c).then(function(b){e.setToken(b);var c=e.getToken();c?g.resolve(c):g.reject(new Error("Token response is not a string: "+a.toJson(b)))})["catch"](g.reject);return h["finally"](function(){g=void 0}),g.promise}throw new Error("No authentication function available to bearhugAuthenticator")}var g;return{authenticate:f}}function e(a,b,c){function d(a){var b=c.getBearer();return b&&a&&a.headers&&(a.headers.Authorization=b),a}function e(a){var b=a&&a.headers("Authorization");return b&&c.setBearer(b),a}function f(c){var d=b.get("$http"),e=b.get("bearhug");if(c&&c.config&&401===c.status){if(g)return a.reject(c);g=a.defer();var f=e.authenticate(c.config).then(function(){return d(c.config).then(g.resolve)["catch"](g.reject)})["catch"](function(){g.reject(c)});return f["finally"](function(){g=void 0}),g.promise}return a.reject(c)}var g;return{request:d,response:e,responseError:f}}function f(b){function c(){return g||null}function d(b){g=a.isString(b)?b:g}function e(){return b.token2bearer(c())||null}function f(a){var c=b.bearer2token(a);d(c)}var g=null;return{getToken:c,setToken:d,getBearer:e,setBearer:f}}function g(b){function c(a){return{apply:function(b){return d(b,a)}}}function d(b,c){var d={},h=e(c);for(var i in b||{})a.isFunction(b[i])&&a.isFunction(h[i])?d[i]=f(b[i],h[i],g[i]):a.isFunction(b[i])&&(d[i]=b[i]);return d}function e(b){return a.isFunction(b)?{request:b,requestError:b,response:b,responseError:b}:a.isObject(b)?b:{}}function f(a,b,c){return function(){var d=arguments.length>=1?Array.prototype.slice.call(arguments,0):[];return b.apply(null,d)?a.apply(null,d):c.apply(null,d)}}var g={request:function(a){return a},requestError:function(a){return b.reject(a)},response:function(a){return a},responseError:function(a){return b.reject(a)}};return{wrapInterceptor:d,InterceptorFilter:c}}d.$inject=["$http","$injector","$q","bearhugStorage"],e.$inject=["$q","$injector","bearhugStorage"],f.$inject=["bearerUtils"],g.$inject=["$q"],a.module("talis.bearhug",[]),a.module("talis.bearhug").factory("bearerUtils",b),a.module("talis.bearhug").provider("bearhug",c),a.module("talis.bearhug").factory("bearhugAuthenticator",d),a.module("talis.bearhug").factory("bearhugInterceptor",e),a.module("talis.bearhug").factory("bearhugStorage",f),a.module("talis.bearhug").factory("interceptorFilter",g)}(angular);